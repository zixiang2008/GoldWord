<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç¿»è¯‘æ§åˆ¶å°æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007aff;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.2s;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .console-output {
            background: #1e1e1e;
            color: #ffffff;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .console-line {
            margin: 2px 0;
            padding: 2px 0;
        }
        .console-success { color: #4caf50; }
        .console-error { color: #f44336; }
        .console-info { color: #2196f3; }
        .console-warn { color: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¥ï¸ AIç¿»è¯‘æ§åˆ¶å°æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>æµ‹è¯•æŒ‰é’®ï¼ˆå¸¦data-translateå±æ€§ï¼‰</h3>
            <button data-translate="true" id="btn1">ğŸ”„ AIç¿»è¯‘æ‰€æœ‰ç•Œé¢</button>
            <button data-translate="true" id="btn2">ğŸ“¤ å¯¼å‡ºç¿»è¯‘æ•°æ®</button>
            <button data-translate="true" id="btn3">ğŸ“¥ å¯¼å…¥ç¿»è¯‘æ•°æ®</button>
            <button data-translate="true" id="btn4">ä¸ªäººä¸­å¿ƒ</button>
            <button data-translate="true" id="btn5">ğŸ‘ è¦è®°å¾—</button>
            <button data-translate="true" id="btn6">ğŸ‘ ä¸è®°å¾—</button>
        </div>
        
        <div class="test-section">
            <h3>æ§åˆ¶å°æµ‹è¯•</h3>
            <button onclick="runConsoleTest()" id="consoleTestBtn">ğŸš€ è¿è¡Œæ§åˆ¶å°æµ‹è¯•</button>
            <button onclick="clearConsole()" id="clearConsoleBtn">ğŸ—‘ï¸ æ¸…é™¤æ§åˆ¶å°</button>
            <button onclick="testDirectTranslation()" id="directTestBtn">ğŸ§ª ç›´æ¥ç¿»è¯‘æµ‹è¯•</button>
        </div>
        
        <div class="test-section">
            <h3>æ§åˆ¶å°è¾“å‡º</h3>
            <div id="console-output" class="console-output">
                <div class="console-line console-info">æ§åˆ¶å°å°±ç»ªï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
            </div>
        </div>
    </div>

    <script src="language-system/language-system-complete-updated.js"></script>
    <script>
        let consoleOutput = null;
        let isSystemReady = false;
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            consoleOutput = document.getElementById('console-output');
            if (consoleOutput) {
                log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...', 'info');
                initializeSystem();
            } else {
                console.error('æ— æ³•æ‰¾åˆ°æ§åˆ¶å°è¾“å‡ºå…ƒç´ ');
            }
        });
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            if (!consoleOutput) return;
            
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleOutput.appendChild(line);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // åŒæ—¶è¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // åˆå§‹åŒ–ç³»ç»Ÿ
        async function initializeSystem() {
            try {
                log('æ­£åœ¨åˆå§‹åŒ–LanguageSystem...', 'info');
                
                if (typeof LanguageSystem === 'undefined') {
                    throw new Error('LanguageSystem æœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥è„šæœ¬æ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½');
                }
                
                log('âœ… LanguageSystem å·²æ‰¾åˆ°', 'success');
                
                // åˆå§‹åŒ–ç³»ç»Ÿ
                const initSuccess = await LanguageSystem.init({
                    defaultLanguage: 'zh-CN',
                    enableAutoDetect: true,
                    enableCache: true,
                    enableAI: true
                });
                
                if (initSuccess) {
                    log('âœ… ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸï¼', 'success');
                    isSystemReady = true;
                    
                    // å¯ç”¨æµ‹è¯•æŒ‰é’®
                    const buttons = ['consoleTestBtn', 'directTestBtn'];
                    buttons.forEach(btnId => {
                        const btn = document.getElementById(btnId);
                        if (btn) btn.disabled = false;
                    });
                    
                    log('ğŸ¯ ç³»ç»Ÿå·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼', 'success');
                } else {
                    throw new Error('ç³»ç»Ÿåˆå§‹åŒ–è¿”å›å¤±è´¥çŠ¶æ€');
                }
                
            } catch (error) {
                log(`âŒ ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                log('è¯·æ£€æŸ¥è¯­è¨€ç³»ç»Ÿè„šæœ¬æ˜¯å¦æ­£ç¡®åŠ è½½', 'error');
            }
        }
        
        // è¿è¡Œæ§åˆ¶å°æµ‹è¯•
        async function runConsoleTest() {
            if (!isSystemReady) {
                log('âŒ ç³»ç»Ÿå°šæœªå°±ç»ªï¼Œè¯·ç­‰å¾…åˆå§‹åŒ–å®Œæˆ', 'error');
                return;
            }
            
            log('ğŸš€ å¼€å§‹æ§åˆ¶å°æµ‹è¯•...', 'info');
            
            try {
                // æµ‹è¯•1: æ£€æŸ¥å…³é”®å‡½æ•°
                log('ğŸ“‹ æµ‹è¯•1: æ£€æŸ¥å…³é”®å‡½æ•°', 'info');
                const requiredFunctions = [
                    'getAllTranslatableElements',
                    'translateAllUIElements',
                    'extractTranslatableText',
                    'preserveFormatting',
                    'safeUpdateText',
                    'showNotification'
                ];
                
                let allFunctionsExist = true;
                requiredFunctions.forEach(funcName => {
                    if (typeof LanguageSystem[funcName] === 'function') {
                        log(`âœ… ${funcName} å‡½æ•°å­˜åœ¨`, 'success');
                    } else {
                        log(`âŒ ${funcName} å‡½æ•°ä¸å­˜åœ¨`, 'error');
                        allFunctionsExist = false;
                    }
                });
                
                if (!allFunctionsExist) {
                    throw new Error('éƒ¨åˆ†å…³é”®å‡½æ•°ç¼ºå¤±');
                }
                
                // æµ‹è¯•2: è·å–å¯ç¿»è¯‘å…ƒç´ 
                log('ğŸ” æµ‹è¯•2: è·å–å¯ç¿»è¯‘å…ƒç´ ', 'info');
                const elements = LanguageSystem.getAllTranslatableElements();
                log(`æ‰¾åˆ° ${elements.length} ä¸ªå¯ç¿»è¯‘å…ƒç´ `, 'info');
                
                if (elements.length === 0) {
                    log('âš ï¸ æ²¡æœ‰æ‰¾åˆ°å¯ç¿»è¯‘å…ƒç´ ï¼Œè¯·æ£€æŸ¥data-translateå±æ€§', 'warn');
                } else {
                    elements.forEach((el, index) => {
                        const text = el.textContent?.trim() || 'æ— æ–‡æœ¬';
                        log(`  ${index + 1}. ${el.tagName}: "${text}"`, 'info');
                    });
                }
                
                // æµ‹è¯•3: æ–‡æœ¬æå–åŠŸèƒ½
                log('ğŸ“ æµ‹è¯•3: æ–‡æœ¬æå–åŠŸèƒ½', 'info');
                const testTexts = [
                    'ğŸ”„ AIç¿»è¯‘æ‰€æœ‰ç•Œé¢',
                    'ä¸ªäººä¸­å¿ƒ',
                    'https://example.com',
                    '123',
                    '',
                    '   '
                ];
                
                testTexts.forEach(text => {
                    const extracted = LanguageSystem.extractTranslatableText(text);
                    log(`  "${text}" â†’ "${extracted}"`, extracted ? 'success' : 'warn');
                });
                
                // æµ‹è¯•4: æ ¼å¼ä¿æŠ¤åŠŸèƒ½
                log('ğŸ¨ æµ‹è¯•4: æ ¼å¼ä¿æŠ¤åŠŸèƒ½', 'info');
                const formatTests = [
                    { original: 'ğŸ”„ AIç¿»è¯‘æ‰€æœ‰ç•Œé¢', clean: 'AIç¿»è¯‘æ‰€æœ‰ç•Œé¢', translated: 'AI Translate All Interface' },
                    { original: 'ä¸ªäººä¸­å¿ƒ â–¾', clean: 'ä¸ªäººä¸­å¿ƒ', translated: 'Personal Center' }
                ];
                
                formatTests.forEach(test => {
                    const result = LanguageSystem.preserveFormatting(test.original, test.clean, test.translated);
                    log(`  "${test.original}" â†’ "${result}"`, 'success');
                });
                
                // æµ‹è¯•5: å®‰å…¨æ›´æ–°æ–‡æœ¬
                log('ğŸ”’ æµ‹è¯•5: å®‰å…¨æ›´æ–°æ–‡æœ¬åŠŸèƒ½', 'info');
                const testElement = document.createElement('div');
                testElement.textContent = 'æµ‹è¯•æ–‡æœ¬';
                document.body.appendChild(testElement);
                
                LanguageSystem.safeUpdateText(testElement, 'Updated Text');
                log(`  æ›´æ–°ç»“æœ: "${testElement.textContent}"`, 'success');
                
                // æ¸…ç†æµ‹è¯•å…ƒç´ 
                document.body.removeChild(testElement);
                
                log('âœ… æ§åˆ¶å°æµ‹è¯•å®Œæˆï¼', 'success');
                
            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // ç›´æ¥ç¿»è¯‘æµ‹è¯•
        async function testDirectTranslation() {
            if (!isSystemReady) {
                log('âŒ ç³»ç»Ÿå°šæœªå°±ç»ªï¼Œè¯·ç­‰å¾…åˆå§‹åŒ–å®Œæˆ', 'error');
                return;
            }
            
            log('ğŸ§ª å¼€å§‹ç›´æ¥ç¿»è¯‘æµ‹è¯•...', 'info');
            
            try {
                // åˆ‡æ¢åˆ°è‹±æ–‡
                log('æ­£åœ¨åˆ‡æ¢åˆ°è‹±æ–‡è¯­è¨€...', 'info');
                await LanguageSystem.setLanguage('en-US');
                log('âœ… å·²åˆ‡æ¢åˆ°è‹±æ–‡', 'success');
                
                // è·å–å¹¶æ˜¾ç¤ºå½“å‰æŒ‰é’®
                const buttons = document.querySelectorAll('[data-translate="true"]');
                log(`æ‰¾åˆ° ${buttons.length} ä¸ªå¯ç¿»è¯‘æŒ‰é’®`, 'info');
                
                // ä¿å­˜åŸå§‹æ–‡æœ¬
                const originalTexts = {};
                buttons.forEach((btn, index) => {
                    originalTexts[btn.id] = btn.textContent.trim();
                    log(`  æŒ‰é’® ${index + 1}: "${btn.textContent.trim()}"`, 'info');
                });
                
                // æ‰§è¡Œç¿»è¯‘
                log('ğŸ”„ å¼€å§‹æ‰§è¡ŒAIç¿»è¯‘...', 'info');
                const result = await LanguageSystem.translateAllUIElements('en-US', (progress) => {
                    log(`  è¿›åº¦: ${progress.percentage}% (${progress.translated}/${progress.total})`, 'info');
                });
                
                log(`âœ… ç¿»è¯‘å®Œæˆï¼å·²ç¿»è¯‘ ${result.translated}/${result.total} ä¸ªå…ƒç´ `, 'success');
                
                // æ˜¾ç¤ºç¿»è¯‘ç»“æœ
                log('ğŸ“Š ç¿»è¯‘ç»“æœ:', 'info');
                buttons.forEach((btn, index) => {
                    const original = originalTexts[btn.id];
                    const translated = btn.textContent.trim();
                    if (original !== translated) {
                        log(`  âœ… "${original}" â†’ "${translated}"`, 'success');
                    } else {
                        log(`  âš ï¸ "${original}" (æœªå˜åŒ–)`, 'warn');
                    }
                });
                
                // åˆ‡æ¢å›ä¸­æ–‡
                log('æ­£åœ¨åˆ‡æ¢å›ä¸­æ–‡...', 'info');
                await LanguageSystem.setLanguage('zh-CN');
                log('âœ… å·²åˆ‡æ¢å›ä¸­æ–‡', 'success');
                
                log('ğŸ¯ ç›´æ¥ç¿»è¯‘æµ‹è¯•å®Œæˆï¼', 'success');
                
            } catch (error) {
                log(`âŒ ç›´æ¥ç¿»è¯‘æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log('é”™è¯¯è¯¦æƒ…: ' + error.stack, 'error');
            }
        }
        
        // æ¸…é™¤æ§åˆ¶å°
        function clearConsole() {
            if (consoleOutput) {
                consoleOutput.innerHTML = '<div class="console-line console-info">æ§åˆ¶å°å·²æ¸…é™¤ï¼Œå‡†å¤‡å¼€å§‹æ–°çš„æµ‹è¯•...</div>';
            }
        }
        
        // åˆå§‹åŒ–æ—¶ç¦ç”¨æµ‹è¯•æŒ‰é’®
        window.addEventListener('DOMContentLoaded', function() {
            const testButtons = ['consoleTestBtn', 'directTestBtn'];
            testButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) btn.disabled = true;
            });
        });
    </script>
</body>
</html>