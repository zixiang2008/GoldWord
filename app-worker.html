<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>GoldWord ä¸‹è½½ä¸­å¿ƒ - WorkeråŠ é€Ÿ</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;margin:0;background:#fff;color:#333}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    h1{font-size:24px;margin:0 0 12px}
    .ver{font-size:14px;color:#666;margin-bottom:16px}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .card{border:1px solid #e5e5e5;border-radius:12px;padding:14px;background:#fafafa;transition:all .2s}
    .card:hover{box-shadow:0 2px 8px rgba(0,0,0,.08);transform:translateY(-1px)}
    .card h3{margin:0 0 8px;font-size:16px}
    .card .desc{font-size:13px;color:#666;margin-bottom:8px}
    .card .size-info{font-size:12px;color:#999;margin-bottom:8px}
    .card .worker-badge{display:inline-block;background:#ff6b35;color:#fff;padding:2px 6px;border-radius:4px;font-size:11px;margin-bottom:8px}
    .card .download-group{display:flex;gap:8px;flex-wrap:wrap}
    .card a{display:inline-block;padding:8px 12px;border-radius:8px;text-decoration:none;font-size:13px;font-weight:500;transition:all .2s}
    .card .worker-link{background:#007aff;color:#fff}
    .card .worker-link:hover{background:#0056b3}
    .card .github-link{background:#24292e;color:#fff}
    .card .github-link:hover{background:#1a1e22}
    .note{margin-top:20px;font-size:13px;color:#555;background:#f8f9fa;padding:16px;border-radius:8px}
    .worker-notice{background:#e8f4fd;border:1px solid #b3d7f0;color:#0066cc;padding:12px;border-radius:8px;margin-bottom:16px;font-size:14px}
    .worker-notice strong{color:#004499}
    @media(max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:460px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>GoldWord ä¸‹è½½ä¸­å¿ƒ</h1>
    <div class="ver" id="ver">å½“å‰ç‰ˆæœ¬ï¼š</div>
    
    <div class="worker-notice">
      <strong>ğŸš€ WorkeråŠ é€Ÿä¸‹è½½</strong><br>
      æ‰€æœ‰ä¸‹è½½æ–‡ä»¶å·²é€šè¿‡CloudFlare Workerå…¨çƒåŠ é€Ÿï¼Œä¸‹è½½é€Ÿåº¦æå‡æ˜¾è‘—ã€‚å¦‚é‡é—®é¢˜ï¼Œä»å¯é€šè¿‡GitHubåŸå§‹é“¾æ¥ä¸‹è½½ã€‚
    </div>
    
    <div class="grid" id="grid"></div>
    
    <div class="note">
      <div style="font-weight:600;margin-bottom:6px">ä½¿ç”¨æŒ‡å¼•</div>
      <div style="margin-bottom:8px">ğŸ’¡ <strong>WorkeråŠ é€Ÿ</strong> - é€šè¿‡CloudFlareå…¨çƒç½‘ç»œåˆ†å‘ï¼Œä¸‹è½½é€Ÿåº¦æ›´å¿«</div>
      <div style="margin-bottom:8px">ğŸ“± <strong>ç§»åŠ¨è®¾å¤‡</strong> - æ ¹æ®è®¾å¤‡ç±»å‹é€‰æ‹©å¯¹åº”ç‰ˆæœ¬è·å¾—æœ€ä½³ä½“éªŒ</div>
      <div style="margin-bottom:8px">ğŸ’» <strong>æ¡Œé¢è®¾å¤‡</strong> - Windowsé€‰æ‹©.exeå®‰è£…åŒ…ï¼ŒmacOSé€‰æ‹©.dmgæˆ–.app.zip</div>
      <div>âš ï¸ <strong>å®‰å…¨æç¤º</strong> - å¦‚ç³»ç»Ÿæ‹¦æˆªï¼Œè¯·é€‰æ‹©"ä»è¦è¿è¡Œ/ä¿ç•™"ä»¥ç»§ç»­å®‰è£…</div>
    </div>
  </div>
  
  <script>
  (async function(){
    // âš ï¸ é‡è¦ï¼šè¯·å°†æ­¤å¤„çš„WORKER_SUBDOMAINæ›¿æ¢ä¸ºæ‚¨çš„å®é™…Workerå­åŸŸå
    const WORKER_SUBDOMAIN = 'goldword-downloads-worker.caishen-us-kg.workers.dev';
    const CDN_BASE = `https://${WORKER_SUBDOMAIN}`;
    const GITHUB_BASE = 'https://github.com/zixiang2008/GoldWord/releases/download';
    
    const verEl = document.getElementById('ver');
    const grid = document.getElementById('grid');
    
    function fmtSize(bytes) { 
      if(!bytes && bytes!==0) return ''; 
      const u=['B','KB','MB','GB']; 
      let i=0; 
      let v=Number(bytes); 
      while(v>=1024&&i<u.length-1){ v/=1024; i++; } 
      return `${v.toFixed(i?2:0)} ${u[i]}`; 
    }
    
    function fmtDate(s) { 
      try{ 
        const d=new Date(s); 
        if(isNaN(d.getTime())) return ''; 
        const y=d.getFullYear(); 
        const m=String(d.getMonth()+1).padStart(2,'0'); 
        const da=String(d.getDate()).padStart(2,'0'); 
        return `${y}-${m}-${da}`; 
      } catch(_) { 
        return ''; 
      } 
    }
    
    function createDownloadCard(title, description, workerUrl, githubUrl, size, mtime, fileName) {
      const card = document.createElement('div');
      card.className = 'card';
      
      const h3 = document.createElement('h3');
      h3.textContent = title;
      card.appendChild(h3);
      
      if(description) {
        const desc = document.createElement('div');
        desc.className = 'desc';
        desc.textContent = description;
        card.appendChild(desc);
      }
      
      if(size || mtime) {
        const sizeInfo = document.createElement('div');
        sizeInfo.className = 'size-info';
        sizeInfo.textContent = `æ–‡ä»¶å¤§å°ï¼š${size ? fmtSize(size) : 'â€”'} ï½œ æ›´æ–°æ—¶é—´ï¼š${mtime ? fmtDate(mtime) : 'â€”'}`;
        card.appendChild(sizeInfo);
      }
      
      const badge = document.createElement('div');
      badge.className = 'worker-badge';
      badge.textContent = 'WorkeråŠ é€Ÿ';
      card.appendChild(badge);
      
      const downloadGroup = document.createElement('div');
      downloadGroup.className = 'download-group';
      
      if(workerUrl) {
        const workerLink = document.createElement('a');
        workerLink.href = workerUrl;
        workerLink.className = 'worker-link';
        workerLink.textContent = 'Workerä¸‹è½½';
        workerLink.target = '_blank';
        downloadGroup.appendChild(workerLink);
      }
      
      if(githubUrl) {
        const githubLink = document.createElement('a');
        githubLink.href = githubUrl;
        githubLink.className = 'github-link';
        githubLink.textContent = 'GitHubä¸‹è½½';
        githubLink.target = '_blank';
        downloadGroup.appendChild(githubLink);
      }
      
      card.appendChild(downloadGroup);
      return card;
    }
    
    try {
      // è·å–ç‰ˆæœ¬ä¿¡æ¯
      const latestRes = await fetch('./downloads/latest.json');
      const latest = await latestRes.json();
      verEl.textContent = `å½“å‰ç‰ˆæœ¬ï¼š${latest.version} (${fmtDate(latest.date)})`;
      
      // è·å–ä¸‹è½½åˆ—è¡¨
      const indexRes = await fetch('./downloads/index.json');
      const data = await indexRes.json();
      
      if (!data.releases || !data.releases.length) {
        grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#999;padding:40px;">æš‚æ— ä¸‹è½½æ–‡ä»¶</div>';
        return;
      }
      
      // æŒ‰ç‰ˆæœ¬æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
      const sortedReleases = data.releases.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      // æ˜¾ç¤ºæœ€æ–°çš„å‡ ä¸ªç‰ˆæœ¬
      const displayReleases = sortedReleases.slice(0, 2);
      
      displayReleases.forEach(release => {
        if (release.files && release.files.length) {
          release.files.forEach(file => {
            const workerUrl = `${CDN_BASE}/${release.version}/${file.name}`;
            const githubUrl = `${GITHUB_BASE}/v${release.version}/${file.name}`;
            
            let title = file.name;
            let description = '';
            
            // æ ¹æ®æ–‡ä»¶åè®¾ç½®æ ‡é¢˜å’Œæè¿°
            if (file.name.includes('mac') && file.name.includes('.dmg')) {
              title = 'macOS å®‰è£…åŒ…ï¼ˆDMGï¼‰';
              description = 'é€‚ç”¨äºmacOSç³»ç»Ÿçš„å®‰è£…åŒ…ï¼Œä¸‹è½½ååŒå‡»å®‰è£…';
            } else if (file.name.includes('mac') && file.name.includes('.app.zip')) {
              title = 'macOS åº”ç”¨åŒ…ï¼ˆAPPï¼‰';
              description = 'macOSåº”ç”¨ç¨‹åºåŒ…ï¼Œè§£å‹åç›´æ¥ä½¿ç”¨';
            } else if (file.name.includes('win')) {
              title = 'Windows å®‰è£…åŒ…';
              description = 'é€‚ç”¨äºWindowsç³»ç»Ÿçš„å®‰è£…ç¨‹åº';
            } else if (file.name.includes('android') && file.name.includes('pad')) {
              title = 'Android å¹³æ¿ç‰ˆ';
              description = 'ä¸“ä¸ºå¹³æ¿ç”µè„‘ä¼˜åŒ–çš„Androidç‰ˆæœ¬';
            } else if (file.name.includes('android') && file.name.includes('phone')) {
              title = 'Android æ‰‹æœºç‰ˆ';
              description = 'é€‚ç”¨äºAndroidæ‰‹æœºçš„ç‰ˆæœ¬';
            } else if (file.name.includes('ipad')) {
              title = 'iPad ç‰ˆ';
              description = 'ä¸“ä¸ºiPadä¼˜åŒ–çš„ç‰ˆæœ¬';
            } else if (file.name.includes('ios')) {
              title = 'iOS ç‰ˆ';
              description = 'é€‚ç”¨äºiPhoneçš„ç‰ˆæœ¬';
            } else if (file.name.includes('web')) {
              title = 'Web ç‰ˆ';
              description = 'ç½‘é¡µç‰ˆï¼Œæ— éœ€å®‰è£…å³å¯ä½¿ç”¨';
            }
            
            const card = createDownloadCard(
              title,
              description,
              workerUrl,
              githubUrl,
              file.size,
              file.mtime,
              file.name
            );
            
            grid.appendChild(card);
          });
        }
      });
      
    } catch (error) {
      console.error('åŠ è½½ä¸‹è½½ä¿¡æ¯å¤±è´¥:', error);
      grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#d32f2f;padding:40px;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
    }
  })();
  </script>
</body>
</html>