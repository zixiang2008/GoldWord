<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoldWord å¤šè¯­è¨€ç³»ç»Ÿ - ç®€åŒ–æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007aff;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.2s;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .language-selector {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            margin: 10px 0;
        }
        #translation-demo {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4fd;
            border-radius: 8px;
            border: 1px solid #b8daff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ GoldWord å¤šè¯­è¨€ç³»ç»Ÿæµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ç³»ç»ŸçŠ¶æ€</h3>
            <div id="system-status" class="test-result info">æ­£åœ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...</div>
        </div>
        
        <div class="test-section">
            <h3>åŠŸèƒ½æµ‹è¯•</h3>
            <button onclick="runBasicTests()">ğŸ” è¿è¡ŒåŸºç¡€æµ‹è¯•</button>
            <button onclick="testTranslation()">ğŸ”„ æµ‹è¯•ç¿»è¯‘åŠŸèƒ½</button>
            <button onclick="testLanguageSwitching()">ğŸŒ æµ‹è¯•è¯­è¨€åˆ‡æ¢</button>
            <button onclick="testAITranslation()">ğŸ¤– æµ‹è¯•AIç¿»è¯‘</button>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h3>è¯­è¨€é€‰æ‹©å™¨</h3>
            <div id="language-selector-container"></div>
        </div>
        
        <div class="test-section">
            <h3>ç¿»è¯‘æ¼”ç¤º</h3>
            <div id="translation-demo">
                <p><strong>å½“å‰è¯­è¨€:</strong> <span id="current-lang">-</span></p>
                <p><strong>æµ‹è¯•æ–‡æœ¬:</strong> <span id="test-text">Hello World</span></p>
                <p><strong>ç¿»è¯‘ç»“æœ:</strong> <span id="translated-text">-</span></p>
            </div>
        </div>
        
        <div class="test-section">
            <h3>æ•°æ®ç®¡ç†</h3>
            <button onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
            <button onclick="importData()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
            <button onclick="showSystemInfo()">â„¹ï¸ ç³»ç»Ÿä¿¡æ¯</button>
        </div>
    </div>

    <script src="language-system/language-system-complete-updated.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let testResults = [];
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', async function() {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–å¤šè¯­è¨€ç³»ç»Ÿ...');
            await initializeSystem();
        });
        
        // åˆå§‹åŒ–ç³»ç»Ÿ
        async function initializeSystem() {
            const statusEl = document.getElementById('system-status');
            
            try {
                statusEl.textContent = 'æ­£åœ¨åˆå§‹åŒ–å¤šè¯­è¨€ç³»ç»Ÿ...';
                
                // æ£€æŸ¥è¯­è¨€ç³»ç»Ÿæ˜¯å¦å­˜åœ¨
                if (typeof LanguageSystem === 'undefined') {
                    throw new Error('LanguageSystem æœªå®šä¹‰ - è¯·æ£€æŸ¥è„šæœ¬æ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½');
                }
                
                console.log('âœ… LanguageSystem å·²æ‰¾åˆ°ï¼Œå¼€å§‹åˆå§‹åŒ–...');
                
                // åˆå§‹åŒ–ç³»ç»Ÿ
                const initSuccess = await LanguageSystem.init({
                    defaultLanguage: 'zh-CN',
                    enableAutoDetect: true,
                    enableCache: true,
                    enableAI: true
                });
                
                if (initSuccess) {
                    statusEl.innerHTML = '<strong style="color: green;">âœ… ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ</strong>';
                    console.log('ğŸ‰ å¤šè¯­è¨€ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼');
                    
                    // åˆ›å»ºè¯­è¨€é€‰æ‹©å™¨
                    createLanguageSelector();
                    
                    // æ›´æ–°å½“å‰è¯­è¨€æ˜¾ç¤º
                    updateCurrentLanguage();
                    
                } else {
                    throw new Error('ç³»ç»Ÿåˆå§‹åŒ–è¿”å›å¤±è´¥çŠ¶æ€');
                }
                
            } catch (error) {
                console.error('âŒ ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', error);
                statusEl.innerHTML = `<strong style="color: red;">âŒ ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:</strong><br>${error.message}`;
            }
        }
        
        // åˆ›å»ºè¯­è¨€é€‰æ‹©å™¨
        function createLanguageSelector() {
            try {
                const container = document.getElementById('language-selector-container');
                const selector = LanguageSystem.createLanguageSelector();
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬
                selector.addEventListener('change', function() {
                    updateCurrentLanguage();
                    updateTranslationDemo();
                });
                
                container.appendChild(selector);
                addTestResult('è¯­è¨€é€‰æ‹©å™¨', 'æˆåŠŸåˆ›å»º', 'success');
                
            } catch (error) {
                addTestResult('è¯­è¨€é€‰æ‹©å™¨', `åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ›´æ–°å½“å‰è¯­è¨€æ˜¾ç¤º
        function updateCurrentLanguage() {
            const currentLang = LanguageSystem.getCurrentLanguage();
            document.getElementById('current-lang').textContent = currentLang;
            
            const langInfo = LanguageSystem.getLanguageInfo(currentLang);
            if (langInfo) {
                document.getElementById('current-lang').textContent = `${langInfo.flag} ${langInfo.name} (${currentLang})`;
            }
        }
        
        // æ›´æ–°ç¿»è¯‘æ¼”ç¤º
        function updateTranslationDemo() {
            try {
                const testText = document.getElementById('test-text').textContent;
                const translated = LanguageSystem.t('hello', testText);
                document.getElementById('translated-text').textContent = translated;
            } catch (error) {
                document.getElementById('translated-text').textContent = `ç¿»è¯‘é”™è¯¯: ${error.message}`;
            }
        }
        
        // è¿è¡ŒåŸºç¡€æµ‹è¯•
        function runBasicTests() {
            clearResults();
            addTestResult('åŸºç¡€åŠŸèƒ½æµ‹è¯•', 'å¼€å§‹æµ‹è¯•...', 'info');
            
            try {
                // æµ‹è¯•1: æ£€æŸ¥æ ¸å¿ƒåŠŸèƒ½
                testCoreFunctions();
                
                // æµ‹è¯•2: æ£€æŸ¥ç¿»è¯‘å‡½æ•°
                testTranslationFunction();
                
                // æµ‹è¯•3: æ£€æŸ¥è¯­è¨€ä¿¡æ¯
                testLanguageInfo();
                
                // æµ‹è¯•4: æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
                testSystemStatus();
                
                addTestResult('åŸºç¡€æµ‹è¯•', 'æ‰€æœ‰åŸºç¡€æµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                addTestResult('åŸºç¡€æµ‹è¯•', `æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
        function testCoreFunctions() {
            const tests = [
                { name: 'ç¿»è¯‘å‡½æ•° t()', func: () => typeof LanguageSystem.t === 'function' },
                { name: 'è¯­è¨€åˆ‡æ¢ setLanguage()', func: () => typeof LanguageSystem.setLanguage === 'function' },
                { name: 'è¯­è¨€æ£€æµ‹ detectBrowserLanguage()', func: () => typeof LanguageSystem.detectBrowserLanguage === 'function' },
                { name: 'è·å–å½“å‰è¯­è¨€ getCurrentLanguage()', func: () => typeof LanguageSystem.getCurrentLanguage === 'function' },
                { name: 'è·å–è¯­è¨€ä¿¡æ¯ getLanguageInfo()', func: () => typeof LanguageSystem.getLanguageInfo === 'function' }
            ];
            
            tests.forEach(test => {
                try {
                    const result = test.func();
                    addTestResult(test.name, result ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨', result ? 'success' : 'error');
                } catch (error) {
                    addTestResult(test.name, `âŒ é”™è¯¯: ${error.message}`, 'error');
                }
            });
        }
        
        // æµ‹è¯•ç¿»è¯‘å‡½æ•°
        function testTranslationFunction() {
            try {
                const testCases = [
                    { key: 'hello', fallback: 'Hello', expected: 'Hello' },
                    { key: 'test_key', fallback: 'Test Text', expected: 'Test Text' }
                ];
                
                testCases.forEach(testCase => {
                    const result = LanguageSystem.t(testCase.key, testCase.fallback);
                    const success = result === testCase.expected;
                    addTestResult(`ç¿»è¯‘æµ‹è¯•: ${testCase.key}`, 
                        success ? `âœ… æ­£ç¡®: "${result}"` : `âŒ é”™è¯¯: æœŸæœ› "${testCase.expected}", å¾—åˆ° "${result}"`, 
                        success ? 'success' : 'error');
                });
                
            } catch (error) {
                addTestResult('ç¿»è¯‘å‡½æ•°æµ‹è¯•', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•è¯­è¨€ä¿¡æ¯
        function testLanguageInfo() {
            try {
                const languages = ['zh-CN', 'en-US', 'th', 'ja'];
                
                languages.forEach(lang => {
                    const info = LanguageSystem.getLanguageInfo(lang);
                    if (info && info.name) {
                        addTestResult(`è¯­è¨€ä¿¡æ¯: ${lang}`, `âœ… ${info.flag} ${info.name}`, 'success');
                    } else {
                        addTestResult(`è¯­è¨€ä¿¡æ¯: ${lang}`, 'âŒ ä¿¡æ¯ä¸å¯ç”¨', 'error');
                    }
                });
                
            } catch (error) {
                addTestResult('è¯­è¨€ä¿¡æ¯æµ‹è¯•', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•ç³»ç»ŸçŠ¶æ€
        function testSystemStatus() {
            try {
                const status = LanguageSystem.getSystemStatus();
                addTestResult('ç³»ç»ŸçŠ¶æ€', 
                    `ç‰ˆæœ¬: ${status.version}<br>` +
                    `åˆå§‹åŒ–: ${status.initialized ? 'âœ…' : 'âŒ'}<br>` +
                    `å½“å‰è¯­è¨€: ${status.currentLanguage}<br>` +
                    `æ”¯æŒè¯­è¨€: ${status.supportedLanguages}ç§<br>` +
                    `ç¿»è¯‘é”®æ•°: ${status.translationKeys}<br>` +
                    `ç¼“å­˜å¤§å°: ${status.cacheSize}<br>` +
                    `å†å²è®°å½•: ${status.historySize}`, 
                    'info');
                
            } catch (error) {
                addTestResult('ç³»ç»ŸçŠ¶æ€æµ‹è¯•', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•ç¿»è¯‘åŠŸèƒ½
        function testTranslation() {
            clearResults();
            addTestResult('ç¿»è¯‘åŠŸèƒ½æµ‹è¯•', 'å¼€å§‹æµ‹è¯•ç¿»è¯‘åŠŸèƒ½...', 'info');
            
            try {
                const currentLang = LanguageSystem.getCurrentLanguage();
                const testTexts = ['Hello', 'World', 'Good morning', 'Thank you'];
                
                testTexts.forEach(text => {
                    try {
                        const translated = LanguageSystem.t(text.toLowerCase().replace(' ', '_'), text);
                        addTestResult(`ç¿»è¯‘: "${text}"`, `ç»“æœ: "${translated}"`, 'info');
                    } catch (error) {
                        addTestResult(`ç¿»è¯‘: "${text}"`, `é”™è¯¯: ${error.message}`, 'error');
                    }
                });
                
                addTestResult('ç¿»è¯‘æµ‹è¯•', 'ç¿»è¯‘åŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                addTestResult('ç¿»è¯‘æµ‹è¯•', `æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•è¯­è¨€åˆ‡æ¢
        async function testLanguageSwitching() {
            clearResults();
            addTestResult('è¯­è¨€åˆ‡æ¢æµ‹è¯•', 'å¼€å§‹æµ‹è¯•è¯­è¨€åˆ‡æ¢åŠŸèƒ½...', 'info');
            
            try {
                const languages = ['zh-CN', 'en-US', 'th'];
                const originalLang = LanguageSystem.getCurrentLanguage();
                
                for (const lang of languages) {
                    try {
                        await LanguageSystem.setLanguage(lang);
                        const currentLang = LanguageSystem.getCurrentLanguage();
                        const success = currentLang === lang;
                        
                        addTestResult(`åˆ‡æ¢è¯­è¨€: ${lang}`, 
                            success ? `âœ… æˆåŠŸåˆ‡æ¢åˆ° ${lang}` : `âŒ åˆ‡æ¢å¤±è´¥ï¼Œå½“å‰è¯­è¨€: ${currentLang}`, 
                            success ? 'success' : 'error');
                            
                        // å»¶è¿Ÿä¸€ä¸‹ï¼Œè®©åˆ‡æ¢ç”Ÿæ•ˆ
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        addTestResult(`åˆ‡æ¢è¯­è¨€: ${lang}`, `âŒ é”™è¯¯: ${error.message}`, 'error');
                    }
                }
                
                // æ¢å¤åŸè¯­è¨€
                await LanguageSystem.setLanguage(originalLang);
                addTestResult('è¯­è¨€åˆ‡æ¢', 'è¯­è¨€åˆ‡æ¢æµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                addTestResult('è¯­è¨€åˆ‡æ¢æµ‹è¯•', `æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•AIç¿»è¯‘
        async function testAITranslation() {
            clearResults();
            addTestResult('AIç¿»è¯‘æµ‹è¯•', 'å¼€å§‹æµ‹è¯•AIç¿»è¯‘åŠŸèƒ½...', 'info');
            
            try {
                const testText = "Hello World";
                const targetLang = 'zh-CN';
                
                addTestResult('AIç¿»è¯‘', `æµ‹è¯•æ–‡æœ¬: "${testText}"`, 'info');
                addTestResult('AIç¿»è¯‘', `ç›®æ ‡è¯­è¨€: ${targetLang}`, 'info');
                
                // ä½¿ç”¨AIç¿»è¯‘
                const result = await LanguageSystem.translateWithAI(testText, targetLang, 'en');
                
                if (result && result !== testText) {
                    addTestResult('AIç¿»è¯‘ç»“æœ', `âœ… "${result}"`, 'success');
                } else {
                    addTestResult('AIç¿»è¯‘ç»“æœ', 'âŒ ç¿»è¯‘å¤±è´¥æˆ–ç»“æœç›¸åŒ', 'error');
                }
                
            } catch (error) {
                addTestResult('AIç¿»è¯‘', `âŒ é”™è¯¯: ${error.message}`, 'error');
                addTestResult('AIç¿»è¯‘æç¤º', 'æ³¨æ„: AIç¿»è¯‘ä½¿ç”¨æ¨¡æ‹ŸAPIï¼Œéœ€è¦é…ç½®çœŸå®APIå¯†é’¥', 'info');
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            try {
                LanguageSystem.exportTranslationData();
                addTestResult('æ•°æ®å¯¼å‡º', 'âœ… ç¿»è¯‘æ•°æ®å·²å¯¼å‡º', 'success');
            } catch (error) {
                addTestResult('æ•°æ®å¯¼å‡º', `âŒ å¯¼å‡ºå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // å¯¼å…¥æ•°æ®
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const data = JSON.parse(event.target.result);
                            LanguageSystem.importTranslationData(data);
                            addTestResult('æ•°æ®å¯¼å…¥', 'âœ… ç¿»è¯‘æ•°æ®å·²å¯¼å…¥', 'success');
                        } catch (error) {
                            addTestResult('æ•°æ®å¯¼å…¥', `âŒ å¯¼å…¥å¤±è´¥: ${error.message}`, 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
        function showSystemInfo() {
            clearResults();
            try {
                const status = LanguageSystem.getSystemStatus();
                let info = `
ğŸŒ <strong>GoldWord å¤šè¯­è¨€ç³»ç»Ÿä¿¡æ¯</strong>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ <strong>åŸºæœ¬çŠ¶æ€:</strong>
   ç‰ˆæœ¬: ${status.version}
   åˆå§‹åŒ–: ${status.initialized ? 'âœ…' : 'âŒ'}
   å½“å‰è¯­è¨€: ${status.currentLanguage}
   
ğŸ—£ï¸ <strong>è¯­è¨€æ”¯æŒ:</strong>
   æ”¯æŒè¯­è¨€: ${status.supportedLanguages}ç§
   ç¿»è¯‘é”®æ•°: ${status.translationKeys}
   
ğŸ’¾ <strong>æ•°æ®å­˜å‚¨:</strong>
   ç¼“å­˜å¤§å°: ${status.cacheSize}
   å†å²è®°å½•: ${status.historySize}
   
ğŸ¤– <strong>AIç¿»è¯‘:</strong>
   AIç¿»è¯‘è¿›è¡Œä¸­: ${status.aiTranslationInProgress ? 'æ˜¯' : 'å¦'}
                `;
                
                addTestResult('ç³»ç»Ÿä¿¡æ¯', info, 'info');
                
            } catch (error) {
                addTestResult('ç³»ç»Ÿä¿¡æ¯', `âŒ è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // è¾…åŠ©å‡½æ•°
        function addTestResult(title, content, type) {
            const resultsContainer = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `<strong>${title}:</strong> ${content}`;
            resultsContainer.appendChild(resultDiv);
            
            // æ»šåŠ¨åˆ°æœ€æ–°ç»“æœ
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            testResults = [];
        }
    </script>
</body>
</html>